# gh를 사용한 시크릿 자동 적용
# GH_PAT (admin:repo) 한 번 설정 후 workflow_dispatch 또는 push 시 자동 실행
name: Sync Secrets

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - ".env.example"
      - "scripts/setup-secrets.sh"
      - "src/config/giscus.ts"
      - ".github/workflows/sync-secrets.yml"

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Apply GitHub Secrets via gh
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          if [[ -z "$GH_TOKEN" ]]; then
            echo "⚠️ GH_PAT 미설정. Settings → Secrets에 GH_PAT 추가 후 재실행하세요."
            echo "   https://github.com/settings/tokens (admin:repo scope)"
            exit 0
          fi
          echo "$GH_TOKEN" | gh auth login --with-token
          REPO="alstjd0051/apt-chart"
          echo "R_kgDORTg8Sg" | gh secret set VITE_GISCUS_REPO_ID --repo "$REPO"
          echo "DIC_kwDORTg8Ss4C2v-L" | gh secret set VITE_GISCUS_CATEGORY_ID --repo "$REPO"
          echo "team_iIHvK8awOTcdLEdDGQKUFGzV" | gh secret set VERCEL_ORG_ID --repo "$REPO"
          echo "prj_86gsYyAkmdFapV0quMNQVRfqJmsU" | gh secret set VERCEL_PROJECT_ID --repo "$REPO"
          echo "✅ GitHub Secrets 적용 완료"
